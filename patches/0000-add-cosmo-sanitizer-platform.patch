From b961f698e042ef0739677baeabd92ac5aae79b99 Mon Sep 17 00:00:00 2001
From: Lily <egzozu.be.bas@gmail.com>
Date: Tue, 25 Feb 2025 14:02:21 +0300
Subject: [PATCH] Update sanitizer_platform.h

---
 compiler-rt/lib/sanitizer_common/sanitizer_platform.h | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/compiler-rt/lib/sanitizer_common/sanitizer_platform.h b/compiler-rt/lib/sanitizer_common/sanitizer_platform.h
index 57966403c92a9..a082c9816691c 100644
--- a/compiler-rt/lib/sanitizer_common/sanitizer_platform.h
+++ b/compiler-rt/lib/sanitizer_common/sanitizer_platform.h
@@ -14,7 +14,7 @@
 
 #if !defined(__linux__) && !defined(__FreeBSD__) && !defined(__NetBSD__) && \
     !defined(__APPLE__) && !defined(_WIN32) && !defined(__Fuchsia__) &&     \
-    !(defined(__sun__) && defined(__svr4__))
+    !(defined(__sun__) && defined(__svr4__)) && !defined(__COSMOPOLITAN__)
 #  error "This operating system is not supported"
 #endif
 
@@ -37,6 +37,12 @@
 #  define SANITIZER_GLIBC 0
 #endif
 
+#if defined(__COSMOPOLITAN__)
+#  define SANITIZER_COSMOPOLITAN 1
+#else
+#  define SANITIZER_COSMOPOLITAN 0
+#endif
+
 #if defined(__FreeBSD__)
 #  define SANITIZER_FREEBSD 1
 #else
@@ -138,7 +144,7 @@
 
 #define SANITIZER_POSIX                                     \
   (SANITIZER_FREEBSD || SANITIZER_LINUX || SANITIZER_APPLE || \
-   SANITIZER_NETBSD || SANITIZER_SOLARIS)
+   SANITIZER_NETBSD || SANITIZER_SOLARIS || SANITIZER_COSMOPOLITAN)
 
 #if __LP64__ || defined(_WIN64)
 #  define SANITIZER_WORDSIZE 64
